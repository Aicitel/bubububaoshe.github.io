<!DOCUMENTTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="main.css">
	<script src="model.js"></script>
</head>

<body>
	<div id="main">
		<div id="scoreboard"></div>
		<div id="table">
			<div id="hand0"></div>
			<div id="pool"></div>
			<div id="hand1"></div>
		</div>
		<div id="specialboard"></div>
	</div>
</body>

</html>
<script>
	var MAINRATIO = 1920 / 1080; //width/height ratio of the main board
	var CARDRATIO = 182 / 240; //width/height ratio of a card
	var BLOCKMARGIN = 1; //margin in px between game blocks
	var MAINMARGINPERCENT = 0.0; //margin of the main board wrt window size
	var SCOREBOARDPERCENT = 0.333; //width of the score board wrt main width
	var SPECIALBOARDPERCENT = 0.3; //width of the special card board wrt main width
	var PLAYER0PERCENT = 0.28; //height of player0 hand board wrt table height
	var PLAYER1PERCENT = 0.345; //height of player1 hand board wrt table height
	var HANDLEFTPADDINGPERCENT = 0.04; //left padding of the hand boards in percent
	var HANDTOPPERCENT = 0.7; //top of inactive cards at player1 hand board
	var HANDTOPPERCENT2 = 0.2; //top of active cards at player1 hand board
	var HANDCARDOVERLAPPERCENT = 0.44; //percent of neighboring cards that overlap
	var CARDBORDERRADIUSPERCENT = 0.04; //border radius of cards wrt card width
	var CARDBACKFILE = "img/back.jpg"; //file name of the back of a card

	function getCSSInt(name) {
		var cv = getComputedStyle(document.documentElement).getPropertyValue(name);
		cv = parseInt(cv.substring(0, cv.length - 2));
		return cv;
	}

	function setCSSInt(name, val) {
		document.documentElement.style.setProperty(name, val + "px");
	}

	function createCardDiv(char, display) {
		var div = document.createElement("div");
		div.classList.add("card");
		div.id = "card" + char.getID();
		if (display == "show")
			div.style.backgroundImage = "url('" + char.getPortrait() + "')";
		else if (display == "hidden")
			div.style.backgroundImage = "url('" + CARDBACKFILE + "')";
		else
			alert("Invalid card display mode: " + display);
		return div;
	}

	class CardDiv {
		constructor(div) {
			this.container = div;
		}
		addCard(cardDiv) {
			this.container.appendChild(cardDiv);
		}
	}
	class Hand0Div extends CardDiv {
		constructor(div, player) {
			super(div);
			this.player = player;
			var chars = this.player.getHand().getChars();
			for (var i = 0; i < chars.length; i++)
				this.addCard(createCardDiv(chars[i], "hidden"));
		}
	}
	class Hand1Div extends CardDiv {
		constructor(div, player) {
			super(div);
			this.player = player;
			var chars = this.player.getHand().getChars();
			for (var i = 0; i < chars.length; i++)
				this.addCard(createCardDiv(chars[i], "show"));
		}
	}
	class PoolDiv extends CardDiv {
		constructor(div, pool) {
			super(div);
			this.pool = pool;
			var chars = this.pool.getChars();
			for (var i = 0; i < chars.length; i++)
				this.addCard(createCardDiv(chars[i], "show"));
		}
	}
	class ViewGame {
		constructor(model, controller) {
			this.model = model;
			this.controller = controller;
			this.player0HandDiv = new Hand0Div(document.getElementById("hand0"), this.model.getPlayer0());
			this.player1HandDiv = new Hand1Div(document.getElementById("hand1"), this.model.getPlayer1());
			this.poolDiv = new PoolDiv(document.getElementById("pool"), this.model.getPool());
			this.update();
			window.addEventListener("resize", this.update.bind(this));
		}
		update() {
			this.setSizes();
			this.setPositions();
			var f = "card12";
		}
		setSizes() {
			var winW = window.innerWidth,
				winH = window.innerHeight;
			var mainH = Math.floor(winH - winH * MAINMARGINPERCENT * 2);
			var mainW = Math.floor(winW - winH * MAINMARGINPERCENT * 2);
			if (MAINRATIO > 0) {
				if (mainW / mainH > MAINRATIO)
					mainW = Math.floor(mainH * MAINRATIO);
				else
					mainH = Math.floor(mainW / MAINRATIO);
			}
			var tMargin = Math.floor((winH - mainH) / 2);
			var scbW = Math.floor(mainH * SCOREBOARDPERCENT);
			var spbW = Math.floor(mainH * SPECIALBOARDPERCENT);
			var tableW = mainW - scbW - spbW - BLOCKMARGIN * 2;
			var player0H = Math.floor(mainH * PLAYER0PERCENT);
			var player1H = Math.floor(mainH * PLAYER1PERCENT);
			var poolH = mainH - player0H - player1H - BLOCKMARGIN * 2;
			//var cardH = Math.floor(player0H * CARDHEIGHTPERCENT);
			//var cardW = Math.floor(cardH * CARDRATIO);
			var cardW = Math.floor(tableW * (1 - 3 * HANDLEFTPADDINGPERCENT) / (9 * (1 - HANDCARDOVERLAPPERCENT) + 1));
			var cardH = Math.floor(cardW / CARDRATIO);
			var cardR = Math.floor(cardW * CARDBORDERRADIUSPERCENT);
			setCSSInt("--block-margin", BLOCKMARGIN);
			setCSSInt("--main-height", mainH);
			setCSSInt("--main-width", mainW);
			setCSSInt("--main-margin", tMargin);
			setCSSInt("--scoreboard-width", scbW);
			setCSSInt("--specialboard-width", spbW);
			setCSSInt("--table-width", tableW);
			setCSSInt("--hand0-height", player0H);
			setCSSInt("--hand1-height", player1H);
			setCSSInt("--pool-height", poolH);
			setCSSInt("--card-width", cardW);
			setCSSInt("--card-height", cardH);
			setCSSInt("--card-border-radius", cardR);
		}
		setPositions() {
			this.setHandPosition(this.player0HandDiv.container);
			this.setHandPosition(this.player1HandDiv.container);
		}
		setHandPosition(container) {
			var id = container.id;
			var containerW = container.clientWidth
			var containerH = container.clientHeight;
			var cardW = getCSSInt("--card-width");
			var cardH = getCSSInt("--card-height");

			if (id == "hand1") {
				var cardT = Math.floor((containerH - cardH) * HANDTOPPERCENT);
				var cardT2 = Math.floor((containerH - cardH) * HANDTOPPERCENT2);
				setCSSInt("--hand1-card-top", cardT);
				setCSSInt("--hand1-card-top2", cardT2);
			} else {
				var cardT = Math.floor((containerH - cardH) / 2);
				setCSSInt("--hand0-card-top", cardT);
			}

			var cards = container.childNodes;
			var left = Math.floor(containerW * HANDLEFTPADDINGPERCENT);
			var offset = Math.floor(cardW * (1 - HANDCARDOVERLAPPERCENT));
			for (var i = 0; i < cards.length; i++) {
				cards[i].style.left = left + "px";
				left += offset;
			}
		}
	}

	function vTest() {
		let model = new Model();
		let gameView = new ViewGame(model, 0);
	}

	function log(msg) {
		var para = document.querySelector("#scoreboard");
		para.setAttribute('style', 'white-space: pre;');
		para.textContent += msg+"\n";
	}
	vTest();
</script>
